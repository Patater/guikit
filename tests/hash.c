/*
 *  hash.c
 *  Patater GUI Kit
 *
 *  Created by Jaeden Amero on 2019-05-04.
 *  Copyright 2019. SPDX-License-Identifier: AGPL-3.0-or-later
 */

#include "guikit/hash.h"
#include "test.h"

static int hash_test_chongo(void)
{
    unsigned long h;
    char test[] = "chongo <Landon Curt Noll> /\\../\\";

    h = hash(test, sizeof(test) - 1);
    TEST_EQU(h, 0x9a4e92e6UL);

    return 0;
}

static int hash_test_deadbeef(void)
{
    unsigned long h;
    char test[] = {-34, -83, -66, -17, 0, -91, 90};

    h = hash(test, 0);
    TEST_EQU(h, 0x811c9dc5UL);

    h = hash(test, 1);
    TEST_EQU(h, 0x5b0b5181UL);

    h = hash(test, 2);
    TEST_EQU(h, 0x7ed0c844UL);

    h = hash(test, 3);
    TEST_EQU(h, 0x9cac618eUL);

    h = hash(test, 4);
    TEST_EQU(h, 0x045d4bb3UL);

    h = hash(test, 5);
    TEST_EQU(h, 0x91de2ac9UL);

    h = hash(test, 6);
    TEST_EQU(h, 0x0cbcc804UL);

    h = hash(test, 7);
    TEST_EQU(h, 0x6b2f6bfaUL);

    return 0;
}

#define LEN(x) (sizeof(x)-1)
/* TEST macro does not include trailing NUL byte in the test vector */
#define TEST(x) {x, LEN(x)}
/* TEST0 macro includes the trailing NUL byte in the test vector */
#define TEST0(x) {x, sizeof(x)}
/* REPEAT500 - repeat a string 500 times */
#define R500(x) R100(x)R100(x)R100(x)R100(x)R100(x)
#define R100(x) R10(x)R10(x)R10(x)R10(x)R10(x)R10(x)R10(x)R10(x)R10(x)R10(x)
#define R10(x) x x x x x x x x x x

/*
 * these test vectors are used as part o the FNV test suite
 */
struct test_vector {
    void *buf;		/* start of test vector buffer */
    int len;		/* length of test vector */
};
struct fnv1a_32_test_vector {
    struct test_vector *test;	/* test vector buffer to hash */
    unsigned int fnv1a_32;		/* expected FNV-1a 32 bit hash value */
};
struct fnv1a_64_test_vector {
    struct test_vector *test;	/* test vector buffer to hash */
    unsigned int fnv1a_64[2];		/* expected FNV-1a 64 bit hash value */
};

struct test_vector fnv_test_str[] = {
  TEST(""),
  TEST("a"),
  TEST("b"),
  TEST("c"),
  TEST("d"),
  TEST("e"),

  TEST("f"),
  TEST("fo"),
  TEST("foo"),
  TEST("foob"),
  TEST("fooba"),
  TEST("foobar"),

  TEST0(""),
  TEST0("a"),
  TEST0("b"),
  TEST0("c"),
  TEST0("d"),
  TEST0("e"),

  TEST0("f"),
  TEST0("fo"),
  TEST0("foo"),
  TEST0("foob"),
  TEST0("fooba"),
  TEST0("foobar"),

  TEST("ch"),
  TEST("cho"),
  TEST("chon"),
  TEST("chong"),
  TEST("chongo"),
  TEST("chongo "),
  TEST("chongo w"),
  TEST("chongo wa"),
  TEST("chongo was"),
  TEST("chongo was "),
  TEST("chongo was h"),
  TEST("chongo was he"),
  TEST("chongo was her"),
  TEST("chongo was here"),
  TEST("chongo was here!"),
  TEST("chongo was here!\n"),

  TEST0("ch"),
  TEST0("cho"),
  TEST0("chon"),
  TEST0("chong"),
  TEST0("chongo"),
  TEST0("chongo "),
  TEST0("chongo w"),
  TEST0("chongo wa"),
  TEST0("chongo was"),
  TEST0("chongo was "),
  TEST0("chongo was h"),
  TEST0("chongo was he"),
  TEST0("chongo was her"),
  TEST0("chongo was here"),
  TEST0("chongo was here!"),
  TEST0("chongo was here!\n"),

  TEST("cu"),
  TEST("cur"),
  TEST("curd"),
  TEST("curds"),
  TEST("curds "),
  TEST("curds a"),
  TEST("curds an"),
  TEST("curds and"),
  TEST("curds and "),
  TEST("curds and w"),
  TEST("curds and wh"),
  TEST("curds and whe"),
  TEST("curds and whey"),
  TEST("curds and whey\n"),

  TEST0("cu"),
  TEST0("cur"),
  TEST0("curd"),
  TEST0("curds"),
  TEST0("curds "),
  TEST0("curds a"),
  TEST0("curds an"),
  TEST0("curds and"),
  TEST0("curds and "),
  TEST0("curds and w"),
  TEST0("curds and wh"),
  TEST0("curds and whe"),
  TEST0("curds and whey"),
  TEST0("curds and whey\n"),

  TEST("hi"),
  TEST0("hi"),

  TEST("hello"),
  TEST0("hello"),

  TEST("\xff\x00\x00\x01"),
  TEST("\x01\x00\x00\xff"),
  TEST("\xff\x00\x00\x02"),
  TEST("\x02\x00\x00\xff"),
  TEST("\xff\x00\x00\x03"),
  TEST("\x03\x00\x00\xff"),
  TEST("\xff\x00\x00\x04"),
  TEST("\x04\x00\x00\xff"),
  TEST("\x40\x51\x4e\x44"),
  TEST("\x44\x4e\x51\x40"),
  TEST("\x40\x51\x4e\x4a"),
  TEST("\x4a\x4e\x51\x40"),
  TEST("\x40\x51\x4e\x54"),
  TEST("\x54\x4e\x51\x40"),

  TEST("127.0.0.1"),
  TEST0("127.0.0.1"),
  TEST("127.0.0.2"),
  TEST0("127.0.0.2"),
  TEST("127.0.0.3"),
  TEST0("127.0.0.3"),
  TEST("64.81.78.68"),
  TEST0("64.81.78.68"),
  TEST("64.81.78.74"),
  TEST0("64.81.78.74"),
  TEST("64.81.78.84"),
  TEST0("64.81.78.84"),

  TEST("feedface"),
  TEST0("feedface"),
  TEST("feedfacedaffdeed"),
  TEST0("feedfacedaffdeed"),
  TEST("feedfacedeadbeef"),
  TEST0("feedfacedeadbeef"),

  TEST("line 1\nline 2\nline 3"),

  TEST("chongo <Landon Curt Noll> /\\../\\"),
  TEST0("chongo <Landon Curt Noll> /\\../\\"),

  TEST("chongo (Landon Curt Noll) /\\../\\"),
  TEST0("chongo (Landon Curt Noll) /\\../\\"),

  TEST("http://antwrp.gsfc.nasa.gov/apod/astropix.html"),
  TEST("http://en.wikipedia.org/wiki/Fowler_Noll_Vo_hash"),
  TEST("http://epod.usra.edu/"),
  TEST("http://exoplanet.eu/"),
  TEST("http://hvo.wr.usgs.gov/cam3/"),
  TEST("http://hvo.wr.usgs.gov/cams/HMcam/"),
  TEST("http://hvo.wr.usgs.gov/kilauea/update/deformation.html"),
  TEST("http://hvo.wr.usgs.gov/kilauea/update/images.html"),
  TEST("http://hvo.wr.usgs.gov/kilauea/update/maps.html"),
  TEST("http://hvo.wr.usgs.gov/volcanowatch/current_issue.html"),
  TEST("http://neo.jpl.nasa.gov/risk/"),
  TEST("http://norvig.com/21-days.html"),
  TEST("http://primes.utm.edu/curios/home.php"),
  TEST("http://slashdot.org/"),
  TEST("http://tux.wr.usgs.gov/Maps/155.25-19.5.html"),
  TEST("http://volcano.wr.usgs.gov/kilaueastatus.php"),
  TEST("http://www.avo.alaska.edu/activity/Redoubt.php"),
  TEST("http://www.dilbert.com/fast/"),
  TEST("http://www.fourmilab.ch/gravitation/orbits/"),
  TEST("http://www.fpoa.net/"),
  TEST("http://www.ioccc.org/index.html"),
  TEST("http://www.isthe.com/cgi-bin/number.cgi"),
  TEST("http://www.isthe.com/chongo/bio.html"),
  TEST("http://www.isthe.com/chongo/index.html"),
  TEST("http://www.isthe.com/chongo/src/calc/lucas-calc"),
  TEST("http://www.isthe.com/chongo/tech/astro/venus2004.html"),
  TEST("http://www.isthe.com/chongo/tech/astro/vita.html"),
  TEST("http://www.isthe.com/chongo/tech/comp/c/expert.html"),
  TEST("http://www.isthe.com/chongo/tech/comp/calc/index.html"),
  TEST("http://www.isthe.com/chongo/tech/comp/fnv/index.html"),
  TEST("http://www.isthe.com/chongo/tech/math/number/howhigh.html"),
  TEST("http://www.isthe.com/chongo/tech/math/number/number.html"),
  TEST("http://www.isthe.com/chongo/tech/math/prime/mersenne.html"),
  TEST("http://www.isthe.com/chongo/tech/math/prime/mersenne.html#largest"),
  TEST("http://www.lavarnd.org/cgi-bin/corpspeak.cgi"),
  TEST("http://www.lavarnd.org/cgi-bin/haiku.cgi"),
  TEST("http://www.lavarnd.org/cgi-bin/rand-none.cgi"),
  TEST("http://www.lavarnd.org/cgi-bin/randdist.cgi"),
  TEST("http://www.lavarnd.org/index.html"),
  TEST("http://www.lavarnd.org/what/nist-test.html"),
  TEST("http://www.macosxhints.com/"),
  TEST("http://www.mellis.com/"),
  TEST("http://www.nature.nps.gov/air/webcams/parks/havoso2alert/havoalert.cfm"),
  TEST("http://www.nature.nps.gov/air/webcams/parks/havoso2alert/timelines_24.cfm"),
  TEST("http://www.paulnoll.com/"),
  TEST("http://www.pepysdiary.com/"),
  TEST("http://www.sciencenews.org/index/home/activity/view"),
  TEST("http://www.skyandtelescope.com/"),
  TEST("http://www.sput.nl/~rob/sirius.html"),
  TEST("http://www.systemexperts.com/"),
  TEST("http://www.tq-international.com/phpBB3/index.php"),
  TEST("http://www.travelquesttours.com/index.htm"),
  TEST("http://www.wunderground.com/global/stations/89606.html"),

  TEST(R10("21701")),
  TEST(R10("M21701")),
  TEST(R10("2^21701-1")),
  TEST(R10("\x54\xc5")),
  TEST(R10("\xc5\x54")),
  TEST(R10("23209")),
  TEST(R10("M23209")),
  TEST(R10("2^23209-1")),
  TEST(R10("\x5a\xa9")),
  TEST(R10("\xa9\x5a")),
  TEST(R10("391581216093")),
  TEST(R10("391581*2^216093-1")),
  TEST(R10("\x05\xf9\x9d\x03\x4c\x81")),
  TEST(R10("FEDCBA9876543210")),
  TEST(R10("\xfe\xdc\xba\x98\x76\x54\x32\x10")),
  TEST(R10("EFCDAB8967452301")),
  TEST(R10("\xef\xcd\xab\x89\x67\x45\x23\x01")),
  TEST(R10("0123456789ABCDEF")),
  TEST(R10("\x01\x23\x45\x67\x89\xab\xcd\xef")),
  TEST(R10("1032547698BADCFE")),
  TEST(R10("\x10\x32\x54\x76\x98\xba\xdc\xfe")),
  TEST(R500("\x00")),
  TEST(R500("\x07")),
  TEST(R500("~")),
  TEST(R500("\x7f")),

  {NULL, 0} /* MUST BE LAST */
};

struct fnv1a_32_test_vector fnv1a_32_vector[] = {
    { &fnv_test_str[0], 0x811c9dc5UL },
    { &fnv_test_str[1], 0xe40c292cUL },
    { &fnv_test_str[2], 0xe70c2de5UL },
    { &fnv_test_str[3], 0xe60c2c52UL },
    { &fnv_test_str[4], 0xe10c2473UL },
    { &fnv_test_str[5], 0xe00c22e0UL },
    { &fnv_test_str[6], 0xe30c2799UL },
    { &fnv_test_str[7], 0x6222e842UL },
    { &fnv_test_str[8], 0xa9f37ed7UL },
    { &fnv_test_str[9], 0x3f5076efUL },
    { &fnv_test_str[10], 0x39aaa18aUL },
    { &fnv_test_str[11], 0xbf9cf968UL },
    { &fnv_test_str[12], 0x050c5d1fUL },
    { &fnv_test_str[13], 0x2b24d044UL },
    { &fnv_test_str[14], 0x9d2c3f7fUL },
    { &fnv_test_str[15], 0x7729c516UL },
    { &fnv_test_str[16], 0xb91d6109UL },
    { &fnv_test_str[17], 0x931ae6a0UL },
    { &fnv_test_str[18], 0x052255dbUL },
    { &fnv_test_str[19], 0xbef39fe6UL },
    { &fnv_test_str[20], 0x6150ac75UL },
    { &fnv_test_str[21], 0x9aab3a3dUL },
    { &fnv_test_str[22], 0x519c4c3eUL },
    { &fnv_test_str[23], 0x0c1c9eb8UL },
    { &fnv_test_str[24], 0x5f299f4eUL },
    { &fnv_test_str[25], 0xef8580f3UL },
    { &fnv_test_str[26], 0xac297727UL },
    { &fnv_test_str[27], 0x4546b9c0UL },
    { &fnv_test_str[28], 0xbd564e7dUL },
    { &fnv_test_str[29], 0x6bdd5c67UL },
    { &fnv_test_str[30], 0xdd77ed30UL },
    { &fnv_test_str[31], 0xf4ca9683UL },
    { &fnv_test_str[32], 0x4aeb9bd0UL },
    { &fnv_test_str[33], 0xe0e67ad0UL },
    { &fnv_test_str[34], 0xc2d32fa8UL },
    { &fnv_test_str[35], 0x7f743fb7UL },
    { &fnv_test_str[36], 0x6900631fUL },
    { &fnv_test_str[37], 0xc59c990eUL },
    { &fnv_test_str[38], 0x448524fdUL },
    { &fnv_test_str[39], 0xd49930d5UL },
    { &fnv_test_str[40], 0x1c85c7caUL },
    { &fnv_test_str[41], 0x0229fe89UL },
    { &fnv_test_str[42], 0x2c469265UL },
    { &fnv_test_str[43], 0xce566940UL },
    { &fnv_test_str[44], 0x8bdd8ec7UL },
    { &fnv_test_str[45], 0x34787625UL },
    { &fnv_test_str[46], 0xd3ca6290UL },
    { &fnv_test_str[47], 0xddeaf039UL },
    { &fnv_test_str[48], 0xc0e64870UL },
    { &fnv_test_str[49], 0xdad35570UL },
    { &fnv_test_str[50], 0x5a740578UL },
    { &fnv_test_str[51], 0x5b004d15UL },
    { &fnv_test_str[52], 0x6a9c09cdUL },
    { &fnv_test_str[53], 0x2384f10aUL },
    { &fnv_test_str[54], 0xda993a47UL },
    { &fnv_test_str[55], 0x8227df4fUL },
    { &fnv_test_str[56], 0x4c298165UL },
    { &fnv_test_str[57], 0xfc563735UL },
    { &fnv_test_str[58], 0x8cb91483UL },
    { &fnv_test_str[59], 0x775bf5d0UL },
    { &fnv_test_str[60], 0xd5c428d0UL },
    { &fnv_test_str[61], 0x34cc0ea3UL },
    { &fnv_test_str[62], 0xea3b4cb7UL },
    { &fnv_test_str[63], 0x8e59f029UL },
    { &fnv_test_str[64], 0x2094de2bUL },
    { &fnv_test_str[65], 0xa65a0ad4UL },
    { &fnv_test_str[66], 0x9bbee5f4UL },
    { &fnv_test_str[67], 0xbe836343UL },
    { &fnv_test_str[68], 0x22d5344eUL },
    { &fnv_test_str[69], 0x19a1470cUL },
    { &fnv_test_str[70], 0x4a56b1ffUL },
    { &fnv_test_str[71], 0x70b8e86fUL },
    { &fnv_test_str[72], 0x0a5b4a39UL },
    { &fnv_test_str[73], 0xb5c3f670UL },
    { &fnv_test_str[74], 0x53cc3f70UL },
    { &fnv_test_str[75], 0xc03b0a99UL },
    { &fnv_test_str[76], 0x7259c415UL },
    { &fnv_test_str[77], 0x4095108bUL },
    { &fnv_test_str[78], 0x7559bdb1UL },
    { &fnv_test_str[79], 0xb3bf0bbcUL },
    { &fnv_test_str[80], 0x2183ff1cUL },
    { &fnv_test_str[81], 0x2bd54279UL },
    { &fnv_test_str[82], 0x23a156caUL },
    { &fnv_test_str[83], 0x64e2d7e4UL },
    { &fnv_test_str[84], 0x683af69aUL },
    { &fnv_test_str[85], 0xaed2346eUL },
    { &fnv_test_str[86], 0x4f9f2cabUL },
    { &fnv_test_str[87], 0x02935131UL },
    { &fnv_test_str[88], 0xc48fb86dUL },
    { &fnv_test_str[89], 0x2269f369UL },
    { &fnv_test_str[90], 0xc18fb3b4UL },
    { &fnv_test_str[91], 0x50ef1236UL },
    { &fnv_test_str[92], 0xc28fb547UL },
    { &fnv_test_str[93], 0x96c3bf47UL },
    { &fnv_test_str[94], 0xbf8fb08eUL },
    { &fnv_test_str[95], 0xf3e4d49cUL },
    { &fnv_test_str[96], 0x32179058UL },
    { &fnv_test_str[97], 0x280bfee6UL },
    { &fnv_test_str[98], 0x30178d32UL },
    { &fnv_test_str[99], 0x21addaf8UL },
    { &fnv_test_str[100], 0x4217a988UL },
    { &fnv_test_str[101], 0x772633d6UL },
    { &fnv_test_str[102], 0x08a3d11eUL },
    { &fnv_test_str[103], 0xb7e2323aUL },
    { &fnv_test_str[104], 0x07a3cf8bUL },
    { &fnv_test_str[105], 0x91dfb7d1UL },
    { &fnv_test_str[106], 0x06a3cdf8UL },
    { &fnv_test_str[107], 0x6bdd3d68UL },
    { &fnv_test_str[108], 0x1d5636a7UL },
    { &fnv_test_str[109], 0xd5b808e5UL },
    { &fnv_test_str[110], 0x1353e852UL },
    { &fnv_test_str[111], 0xbf16b916UL },
    { &fnv_test_str[112], 0xa55b89edUL },
    { &fnv_test_str[113], 0x3c1a2017UL },
    { &fnv_test_str[114], 0x0588b13cUL },
    { &fnv_test_str[115], 0xf22f0174UL },
    { &fnv_test_str[116], 0xe83641e1UL },
    { &fnv_test_str[117], 0x6e69b533UL },
    { &fnv_test_str[118], 0xf1760448UL },
    { &fnv_test_str[119], 0x64c8bd58UL },
    { &fnv_test_str[120], 0x97b4ea23UL },
    { &fnv_test_str[121], 0x9a4e92e6UL },
    { &fnv_test_str[122], 0xcfb14012UL },
    { &fnv_test_str[123], 0xf01b2511UL },
    { &fnv_test_str[124], 0x0bbb59c3UL },
    { &fnv_test_str[125], 0xce524afaUL },
    { &fnv_test_str[126], 0xdd16ef45UL },
    { &fnv_test_str[127], 0x60648bb3UL },
    { &fnv_test_str[128], 0x7fa4bcfcUL },
    { &fnv_test_str[129], 0x5053ae17UL },
    { &fnv_test_str[130], 0xc9302890UL },
    { &fnv_test_str[131], 0x956ded32UL },
    { &fnv_test_str[132], 0x9136db84UL },
    { &fnv_test_str[133], 0xdf9d3323UL },
    { &fnv_test_str[134], 0x32bb6cd0UL },
    { &fnv_test_str[135], 0xc8f8385bUL },
    { &fnv_test_str[136], 0xeb08bfbaUL },
    { &fnv_test_str[137], 0x62cc8e3dUL },
    { &fnv_test_str[138], 0xc3e20f5cUL },
    { &fnv_test_str[139], 0x39e97f17UL },
    { &fnv_test_str[140], 0x7837b203UL },
    { &fnv_test_str[141], 0x319e877bUL },
    { &fnv_test_str[142], 0xd3e63f89UL },
    { &fnv_test_str[143], 0x29b50b38UL },
    { &fnv_test_str[144], 0x5ed678b8UL },
    { &fnv_test_str[145], 0xb0d5b793UL },
    { &fnv_test_str[146], 0x52450be5UL },
    { &fnv_test_str[147], 0xfa72d767UL },
    { &fnv_test_str[148], 0x95066709UL },
    { &fnv_test_str[149], 0x7f52e123UL },
    { &fnv_test_str[150], 0x76966481UL },
    { &fnv_test_str[151], 0x063258b0UL },
    { &fnv_test_str[152], 0x2ded6e8aUL },
    { &fnv_test_str[153], 0xb07d7c52UL },
    { &fnv_test_str[154], 0xd0c71b71UL },
    { &fnv_test_str[155], 0xf684f1bdUL },
    { &fnv_test_str[156], 0x868ecfa8UL },
    { &fnv_test_str[157], 0xf794f684UL },
    { &fnv_test_str[158], 0xd19701c3UL },
    { &fnv_test_str[159], 0x346e171eUL },
    { &fnv_test_str[160], 0x91f8f676UL },
    { &fnv_test_str[161], 0x0bf58848UL },
    { &fnv_test_str[162], 0x6317b6d1UL },
    { &fnv_test_str[163], 0xafad4c54UL },
    { &fnv_test_str[164], 0x0f25681eUL },
    { &fnv_test_str[165], 0x91b18d49UL },
    { &fnv_test_str[166], 0x7d61c12eUL },
    { &fnv_test_str[167], 0x5147d25cUL },
    { &fnv_test_str[168], 0x9a8b6805UL },
    { &fnv_test_str[169], 0x4cd2a447UL },
    { &fnv_test_str[170], 0x1e549b14UL },
    { &fnv_test_str[171], 0x2fe1b574UL },
    { &fnv_test_str[172], 0xcf0cd31eUL },
    { &fnv_test_str[173], 0x6c471669UL },
    { &fnv_test_str[174], 0x0e5eef1eUL },
    { &fnv_test_str[175], 0x2bed3602UL },
    { &fnv_test_str[176], 0xb26249e0UL },
    { &fnv_test_str[177], 0x2c9b86a4UL },
    { &fnv_test_str[178], 0xe415e2bbUL },
    { &fnv_test_str[179], 0x18a98d1dUL },
    { &fnv_test_str[180], 0xb7df8b7bUL },
    { &fnv_test_str[181], 0x241e9075UL },
    { &fnv_test_str[182], 0x063f70ddUL },
    { &fnv_test_str[183], 0x0295aed9UL },
    { &fnv_test_str[184], 0x56a7f781UL },
    { &fnv_test_str[185], 0x253bc645UL },
    { &fnv_test_str[186], 0x46610921UL },
    { &fnv_test_str[187], 0x7c1577f9UL },
    { &fnv_test_str[188], 0x512b2851UL },
    { &fnv_test_str[189], 0x76823999UL },
    { &fnv_test_str[190], 0xc0586935UL },
    { &fnv_test_str[191], 0xf3415c85UL },
    { &fnv_test_str[192], 0x0ae4ff65UL },
    { &fnv_test_str[193], 0x58b79725UL },
    { &fnv_test_str[194], 0xdea43aa5UL },
    { &fnv_test_str[195], 0x2bb3be35UL },
    { &fnv_test_str[196], 0xea777a45UL },
    { &fnv_test_str[197], 0x8f21c305UL },
    { &fnv_test_str[198], 0x5c9d0865UL },
    { &fnv_test_str[199], 0xfa823dd5UL },
    { &fnv_test_str[200], 0x21a27271UL },
    { &fnv_test_str[201], 0x83c5c6d5UL },
    { &fnv_test_str[202], 0x813b0881UL },
    { NULL, 0 }
};

struct fnv1a_64_test_vector fnv1a_64_vector[] = {
    { &fnv_test_str[0], {0x84222325UL, 0xcbf29ce4UL} },
    { &fnv_test_str[1], {0x8601ec8cUL, 0xaf63dc4cUL} },
    { &fnv_test_str[2], {0x8601f1a5UL, 0xaf63df4cUL} },
    { &fnv_test_str[3], {0x8601eff2UL, 0xaf63de4cUL} },
    { &fnv_test_str[4], {0x8601e773UL, 0xaf63d94cUL} },
    { &fnv_test_str[5], {0x8601e5c0UL, 0xaf63d84cUL} },
    { &fnv_test_str[6], {0x8601ead9UL, 0xaf63db4cUL} },
    { &fnv_test_str[7], {0xb541d342UL, 0x08985907UL} },
    { &fnv_test_str[8], {0xfed9d577UL, 0xdcb27518UL} },
    { &fnv_test_str[9], {0x0c2512afUL, 0xdd120e79UL} },
    { &fnv_test_str[10], {0xa2fef40aUL, 0xcac165afUL} },
    { &fnv_test_str[11], {0xf73967e8UL, 0x85944171UL} },
    { &fnv_test_str[12], {0x8601b7dfUL, 0xaf63bd4cUL} },
    { &fnv_test_str[13], {0xb544f1e4UL, 0x089be207UL} },
    { &fnv_test_str[14], {0xb54d9b5fUL, 0x08a61407UL} },
    { &fnv_test_str[15], {0xb54ab836UL, 0x08a2ae07UL} },
    { &fnv_test_str[16], {0xb53c4869UL, 0x0891b007UL} },
    { &fnv_test_str[17], {0xb5396540UL, 0x088e4a07UL} },
    { &fnv_test_str[18], {0xb5420ebbUL, 0x08987c07UL} },
    { &fnv_test_str[19], {0xfed9f926UL, 0xdcb28a18UL} },
    { &fnv_test_str[20], {0x0c25b935UL, 0xdd127079UL} },
    { &fnv_test_str[21], {0xa2febf5dUL, 0xcac146afUL} },
    { &fnv_test_str[22], {0xf738acfeUL, 0x8593d371UL} },
    { &fnv_test_str[23], {0x168b8f38UL, 0x34531ca7UL} },
    { &fnv_test_str[24], {0xb54a22aeUL, 0x08a25607UL} },
    { &fnv_test_str[25], {0x0cf90df3UL, 0xf5faf019UL} },
    { &fnv_test_str[26], {0x0b3221c7UL, 0xf2739791UL} },
    { &fnv_test_str[27], {0x062f22e0UL, 0x2c8c2b76UL} },
    { &fnv_test_str[28], {0x8217b8fdUL, 0xe150688cUL} },
    { &fnv_test_str[29], {0x0e4f1f87UL, 0xf35a83c1UL} },
    { &fnv_test_str[30], {0x507344d0UL, 0xd1edd10bUL} },
    { &fnv_test_str[31], {0xb3ddb8c3UL, 0x2a5ee739UL} },
    { &fnv_test_str[32], {0xa1c0d310UL, 0xdcfb970cUL} },
    { &fnv_test_str[33], {0xdaa6da90UL, 0x4054da76UL} },
    { &fnv_test_str[34], {0x89861368UL, 0xf70a2ff5UL} },
    { &fnv_test_str[35], {0xaed25f17UL, 0x4c628b38UL} },
    { &fnv_test_str[36], {0x0f78189fUL, 0x9dd1f651UL} },
    { &fnv_test_str[37], {0x491270ceUL, 0xa3de85bdUL} },
    { &fnv_test_str[38], {0x2a55e61dUL, 0x858e2fa3UL} },
    { &fnv_test_str[39], {0xeff5f915UL, 0x46810940UL} },
    { &fnv_test_str[40], {0x0cf8edaaUL, 0xf5fadd19UL} },
    { &fnv_test_str[41], {0x0b32b3e9UL, 0xf273ed91UL} },
    { &fnv_test_str[42], {0x062f6525UL, 0x2c8c5276UL} },
    { &fnv_test_str[43], {0x821842a0UL, 0xe150b98cUL} },
    { &fnv_test_str[44], {0x0e4f55e7UL, 0xf35aa3c1UL} },
    { &fnv_test_str[45], {0x50729265UL, 0xd1ed680bUL} },
    { &fnv_test_str[46], {0xb3dded70UL, 0x2a5f0639UL} },
    { &fnv_test_str[47], {0xa1c0f359UL, 0xdcfbaa0cUL} },
    { &fnv_test_str[48], {0xdaa6a430UL, 0x4054ba76UL} },
    { &fnv_test_str[49], {0x898562b0UL, 0xf709c7f5UL} },
    { &fnv_test_str[50], {0xaed2f9b8UL, 0x4c62e638UL} },
    { &fnv_test_str[51], {0x0f779415UL, 0x9dd1a851UL} },
    { &fnv_test_str[52], {0x4911d62dUL, 0xa3de2abdUL} },
    { &fnv_test_str[53], {0x2a55ae0aUL, 0x858e0ea3UL} },
    { &fnv_test_str[54], {0xeff60347UL, 0x46810f40UL} },
    { &fnv_test_str[55], {0xbef63eafUL, 0xc33bce57UL} },
    { &fnv_test_str[56], {0xb54a0265UL, 0x08a24307UL} },
    { &fnv_test_str[57], {0x0cc18d15UL, 0xf5b9fd19UL} },
    { &fnv_test_str[58], {0xace35703UL, 0x4c968290UL} },
    { &fnv_test_str[59], {0xc64d9350UL, 0x07174bd5UL} },
    { &fnv_test_str[60], {0xf5d18750UL, 0x5a294c3fUL} },
    { &fnv_test_str[61], {0xb308b843UL, 0x05b3c1aeUL} },
    { &fnv_test_str[62], {0x37d0f477UL, 0xb92a48daUL} },
    { &fnv_test_str[63], {0xd80ebc49UL, 0x73cdddccUL} },
    { &fnv_test_str[64], {0x210a266bUL, 0xd58c4c13UL} },
    { &fnv_test_str[65], {0x243ec194UL, 0xe78b6081UL} },
    { &fnv_test_str[66], {0x96a39f34UL, 0xb096f770UL} },
    { &fnv_test_str[67], {0xf807b6a3UL, 0xb425c54fUL} },
    { &fnv_test_str[68], {0x751bb46eUL, 0x23e520e2UL} },
    { &fnv_test_str[69], {0xfe1385ecUL, 0x1a0b44ccUL} },
    { &fnv_test_str[70], {0x0cc2119fUL, 0xf5ba4b19UL} },
    { &fnv_test_str[71], {0xace2baafUL, 0x4c962690UL} },
    { &fnv_test_str[72], {0xc64cda19UL, 0x0716ded5UL} },
    { &fnv_test_str[73], {0xf5d150f0UL, 0x5a292c3fUL} },
    { &fnv_test_str[74], {0xb308ecf0UL, 0x05b3e0aeUL} },
    { &fnv_test_str[75], {0x37d119d9UL, 0xb92a5edaUL} },
    { &fnv_test_str[76], {0xd80f6635UL, 0x73ce41ccUL} },
    { &fnv_test_str[77], {0x2109f00bUL, 0xd58c2c13UL} },
    { &fnv_test_str[78], {0x243f47d1UL, 0xe78baf81UL} },
    { &fnv_test_str[79], {0x96a2ee7cUL, 0xb0968f70UL} },
    { &fnv_test_str[80], {0xf807855cUL, 0xb425a84fUL} },
    { &fnv_test_str[81], {0x751b56f9UL, 0x23e4e9e2UL} },
    { &fnv_test_str[82], {0xfe1396eaUL, 0x1a0b4eccUL} },
    { &fnv_test_str[83], {0xbb2c9004UL, 0x54abd453UL} },
    { &fnv_test_str[84], {0xb55ec3daUL, 0x08ba5f07UL} },
    { &fnv_test_str[85], {0x3006cb6eUL, 0x33735419UL} },
    { &fnv_test_str[86], {0x80aabd0bUL, 0xa430d846UL} },
    { &fnv_test_str[87], {0xa21f39b1UL, 0xa9bc8accUL} },
    { &fnv_test_str[88], {0x91cc682dUL, 0x69611964UL} },
    { &fnv_test_str[89], {0x4799dfe9UL, 0xad2bb177UL} },
    { &fnv_test_str[90], {0x91cc6314UL, 0x69611664UL} },
    { &fnv_test_str[91], {0x4a3b1236UL, 0x8d1bb390UL} },
    { &fnv_test_str[92], {0x91cc64c7UL, 0x69611764UL} },
    { &fnv_test_str[93], {0xf40434c7UL, 0xed205d87UL} },
    { &fnv_test_str[94], {0x91cc5faeUL, 0x69611464UL} },
    { &fnv_test_str[95], {0x44f8ad9cUL, 0xcd3baf5eUL} },
    { &fnv_test_str[96], {0x127cd6d8UL, 0xe3b36596UL} },
    { &fnv_test_str[97], {0xc8e8a646UL, 0xf77f1072UL} },
    { &fnv_test_str[98], {0x127cd372UL, 0xe3b36396UL} },
    { &fnv_test_str[99], {0x932ad458UL, 0x6067dce9UL} },
    { &fnv_test_str[100], {0x127cf208UL, 0xe3b37596UL} },
    { &fnv_test_str[101], {0x9fe83936UL, 0x4b7b10faUL} },
    { &fnv_test_str[102], {0x04d914beUL, 0xaabafe71UL} },
    { &fnv_test_str[103], {0x3cde3edaUL, 0xf4d3180bUL} },
    { &fnv_test_str[104], {0x04d9130bUL, 0xaabafd71UL} },
    { &fnv_test_str[105], {0x3cdb5bb1UL, 0xf4cfb20bUL} },
    { &fnv_test_str[106], {0x04d91158UL, 0xaabafc71UL} },
    { &fnv_test_str[107], {0x3cd87888UL, 0xf4cc4c0bUL} },
    { &fnv_test_str[108], {0xd2a8d3a7UL, 0xe729bac5UL} },
    { &fnv_test_str[109], {0xf4dfa4c5UL, 0x74bc0524UL} },
    { &fnv_test_str[110], {0xd2a5b352UL, 0xe72630c5UL} },
    { &fnv_test_str[111], {0xef8fb456UL, 0x6b983224UL} },
    { &fnv_test_str[112], {0xd2ae266dUL, 0xe73042c5UL} },
    { &fnv_test_str[113], {0xfdeb4b37UL, 0x8527e324UL} },
    { &fnv_test_str[114], {0xee952abcUL, 0x0a83c86fUL} },
    { &fnv_test_str[115], {0x67779d74UL, 0x73185232UL} },
    { &fnv_test_str[116], {0x6b8caca1UL, 0x3e66d3d5UL} },
    { &fnv_test_str[117], {0xc0095593UL, 0x956694a5UL} },
    { &fnv_test_str[118], {0xbb1a6fc8UL, 0xcac54572UL} },
    { &fnv_test_str[119], {0xedebf0d8UL, 0xa7a4c9f3UL} },
    { &fnv_test_str[120], {0xac17b143UL, 0x7829851fUL} },
    { &fnv_test_str[121], {0xf81bcf06UL, 0x2c8f4c9aUL} },
    { &fnv_test_str[122], {0x9740c732UL, 0xd34e3153UL} },
    { &fnv_test_str[123], {0x253d2db1UL, 0x3605a2acUL} },
    { &fnv_test_str[124], {0x46f4a3c3UL, 0x08c11b83UL} },
    { &fnv_test_str[125], {0x9ce8a6daUL, 0x6be39628UL} },
    { &fnv_test_str[126], {0x7fe794c5UL, 0xd9b957fbUL} },
    { &fnv_test_str[127], {0x04560a93UL, 0x05be33daUL} },
    { &fnv_test_str[128], {0x7ba9747cUL, 0x0957f157UL} },
    { &fnv_test_str[129], {0xc24fba57UL, 0xda2cc3acUL} },
    { &fnv_test_str[130], {0x5b29e7f0UL, 0x74136f18UL} },
    { &fnv_test_str[131], {0x0edb93b2UL, 0xb2f2b459UL} },
    { &fnv_test_str[132], {0x8b86ae04UL, 0xb3608fceUL} },
    { &fnv_test_str[133], {0x79359063UL, 0x4a3a8650UL} },
    { &fnv_test_str[134], {0x96880a50UL, 0x5b3a7ef4UL} },
    { &fnv_test_str[135], {0x3854c23bUL, 0x48fae316UL} },
    { &fnv_test_str[136], {0x476e0b9aUL, 0x07aaa640UL} },
    { &fnv_test_str[137], {0x383a687dUL, 0x2f653656UL} },
    { &fnv_test_str[138], {0x7599d79cUL, 0xa1031f8eUL} },
    { &fnv_test_str[139], {0x8ff92477UL, 0xa3190817UL} },
    { &fnv_test_str[140], {0x14c3fb83UL, 0x097edf3cUL} },
    { &fnv_test_str[141], {0xeaa0971bUL, 0xb51ca83fUL} },
    { &fnv_test_str[142], {0xd784f2e9UL, 0xdd3c0d96UL} },
    { &fnv_test_str[143], {0xea767d78UL, 0x86cd26a9UL} },
    { &fnv_test_str[144], {0x54a30c18UL, 0xe6b215ffUL} },
    { &fnv_test_str[145], {0xc5531093UL, 0xec5b06a1UL} },
    { &fnv_test_str[146], {0x9f9ec5e5UL, 0x45665a92UL} },
    { &fnv_test_str[147], {0xa9f10907UL, 0x8c7609b4UL} },
    { &fnv_test_str[148], {0x91f0d729UL, 0x89aac3a4UL} },
    { &fnv_test_str[149], {0xe0f4a403UL, 0x32ce6b26UL} },
    { &fnv_test_str[150], {0x02b53e01UL, 0x614ab44eUL} },
    { &fnv_test_str[151], {0x6eef3290UL, 0xfa6472ebUL} },
    { &fnv_test_str[152], {0x1948eb6aUL, 0x9e5d75ebUL} },
    { &fnv_test_str[153], {0xa8671852UL, 0xb6d12ad4UL} },
    { &fnv_test_str[154], {0xeba07af1UL, 0x88826f56UL} },
    { &fnv_test_str[155], {0x645bc0fdUL, 0x44535bf2UL} },
    { &fnv_test_str[156], {0xc21e3728UL, 0x169388ffUL} },
    { &fnv_test_str[157], {0x396d8224UL, 0xf68aac9eUL} },
    { &fnv_test_str[158], {0x472b3883UL, 0x8e87d7e7UL} },
    { &fnv_test_str[159], {0xa8b423deUL, 0x295c26caUL} },
    { &fnv_test_str[160], {0x92e72176UL, 0x322c8142UL} },
    { &fnv_test_str[161], {0xb8af7268UL, 0x8a06550eUL} },
    { &fnv_test_str[162], {0x661bcf71UL, 0xef86d60eUL} },
    { &fnv_test_str[163], {0x7f30ee54UL, 0x9e5426c8UL} },
    { &fnv_test_str[164], {0x26fd047eUL, 0xf1ea8aa8UL} },
    { &fnv_test_str[165], {0x642cb769UL, 0x0babaf9aUL} },
    { &fnv_test_str[166], {0x068d012eUL, 0x4b3341d4UL} },
    { &fnv_test_str[167], {0xc30a335cUL, 0xd15605cbUL} },
    { &fnv_test_str[168], {0xed8412e5UL, 0x5b21060aUL} },
    { &fnv_test_str[169], {0xce6f4227UL, 0x45e2cda1UL} },
    { &fnv_test_str[170], {0x033ad7d4UL, 0x50ae3745UL} },
    { &fnv_test_str[171], {0xd46bf414UL, 0xaa4588ceUL} },
    { &fnv_test_str[172], {0x4a95467eUL, 0xc1b0056cUL} },
    { &fnv_test_str[173], {0xde8b4089UL, 0x56576a71UL} },
    { &fnv_test_str[174], {0xa6dc927eUL, 0xbf20965fUL} },
    { &fnv_test_str[175], {0xc2040882UL, 0x569f8383UL} },
    { &fnv_test_str[176], {0xa08feca0UL, 0xe1e772fbUL} },
    { &fnv_test_str[177], {0x97138ac4UL, 0x4ced94afUL} },
    { &fnv_test_str[178], {0x337a82fbUL, 0xc4112ffbUL} },
    { &fnv_test_str[179], {0x1de38b7dUL, 0xd64a4fd4UL} },
    { &fnv_test_str[180], {0x9edebcbbUL, 0x4cfc3232UL} },
    { &fnv_test_str[181], {0x45050395UL, 0x08035644UL} },
    { &fnv_test_str[182], {0xf4642ffdUL, 0xaa1574ecUL} },
    { &fnv_test_str[183], {0x4cc315f9UL, 0x694bc4e5UL} },
    { &fnv_test_str[184], {0x3b011721UL, 0xa3d7cb27UL} },
    { &fnv_test_str[185], {0x6115bfa5UL, 0x577c2f8bUL} },
    { &fnv_test_str[186], {0x769fb4c1UL, 0xb7ec8c1aUL} },
    { &fnv_test_str[187], {0x3359ab19UL, 0x5d5cfce6UL} },
    { &fnv_test_str[188], {0xd65b5f71UL, 0x33b96c3cUL} },
    { &fnv_test_str[189], {0x80602bb9UL, 0xd8450977UL} },
    { &fnv_test_str[190], {0xd02da3d5UL, 0x84d47645UL} },
    { &fnv_test_str[191], {0xb58773a5UL, 0x83544f33UL} },
    { &fnv_test_str[192], {0x160836c5UL, 0x9175cbb2UL} },
    { &fnv_test_str[193], {0x75e72bc5UL, 0xc71b3bc1UL} },
    { &fnv_test_str[194], {0x222ec985UL, 0x636806acUL} },
    { &fnv_test_str[195], {0x50f52ed5UL, 0xb6ef0e69UL} },
    { &fnv_test_str[196], {0xf3dfdaa5UL, 0xead3d8a0UL} },
    { &fnv_test_str[197], {0x9a861ba5UL, 0x922908feUL} },
    { &fnv_test_str[198], {0x275fd5c5UL, 0x6d4821deUL} },
    { &fnv_test_str[199], {0x2bd816b5UL, 0x1fe3fce6UL} },
    { &fnv_test_str[200], {0xd6f70591UL, 0xc23e9fccUL} },
    { &fnv_test_str[201], {0xfe16b5b5UL, 0xc1af12bdUL} },
    { &fnv_test_str[202], {0x2f85e221UL, 0x39e9f18fUL} },
    { NULL, {0,0} }
};

static int hash_test_fnv1a_official(void)
{
    struct fnv1a_32_test_vector *v = fnv1a_32_vector;
    while (v->test)
    {
        unsigned int h = hash(v->test->buf, v->test->len);
        TEST_EQU(h, v->fnv1a_32);

        ++v;
    }
    return 0;
}

static int hash_test_fnv1a64_official(void)
{
    struct fnv1a_64_test_vector *v = fnv1a_64_vector;
    while (v->test)
    {
        u32 h[2];
        hash64(h, v->test->buf, v->test->len);
        TEST_EQU(h[0], v->fnv1a_64[0]);
        TEST_EQU(h[1], v->fnv1a_64[1]);

        ++v;
    }
    return 0;
}

const test_fn tests[] =
{
    hash_test_deadbeef,
    hash_test_chongo,
    hash_test_fnv1a_official,
    hash_test_fnv1a64_official,
    0
};
